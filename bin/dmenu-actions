#!/usr/bin/env bash

source "$( dirname "${BASH_SOURCE[0]}" )/.common.sh"

## Creates a dmenu prompt with actions

PRIVATE_ACTIONS="$( realpath ~/.dotfiles-private/dmenu-actions.sh )"
PUBLIC_ACTIONS="$( realpath ~/.dotfiles/more/dmenu-actions.sh )"

. ${PUBLIC_ACTIONS}
. ${PRIVATE_ACTIONS}

dmenu="$( realpath ~/.dotfiles/bin/dmenu )"

select_option() {
  "${dmenu}" -p "Action"
}

filter_action_name() {
  grep ACTION -A1 | grep -v ACTION | grep -v '\--' | sed 's/(.*//'
}

list_options() {
  cat ${PUBLIC_ACTIONS} | filter_action_name
  cat ${PRIVATE_ACTIONS} | filter_action_name
}

main() {
  local selected_action="$( list_options | select_option )"

  if [ -z "${selected_action}" ]; then
    exit 0
  fi

  ${selected_action}
}

main
