#!/usr/bin/env bash

# TODO Why is this needed now? I'm sure this wasn't needed before 479ee15. May be a bug in systemd, lightdm or dbus
export DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus

cd /

# Automatic monitor setup (blocking)
~/.dotfiles/bin/monitor-setup auto

# Setup keyboard (layout, caps-escape, ...)
~/.dotfiles/bin/keyboard-setup &>/dev/null </dev/null &

# Mouse bindings
xbindkeys &>/dev/null </dev/null &

# Automatic screen lock
xset s 300 &>/dev/null </dev/null &
xss-lock -- betterlockscreen -l dim &>/dev/null </dev/null &

# Compositor needs to be launched after monitor layout has changed
(
sleep 2

picom --config ~/.dotfiles/wm/picom.conf -b --experimental-backends

) &>/dev/null </dev/null &

# Wait some seconds (in background) before launching systray applets
(
sleep 5

# Clipboard manager (gpaste)
gpaste-client start &>/dev/null </dev/null &

# PulseAudio applet
pasystray &>/dev/null </dev/null &

# External storage manager
udiskie &>/dev/null </dev/null &

# Bluetooth applet
blueman-applet &>/dev/null </dev/null &

# NetworkManager applet
nm-applet &>/dev/null </dev/null &

) &>/dev/null </dev/null &

exit 0
